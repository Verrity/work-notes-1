---
### Теги
#info #snmp
### Назад
#### [[Home]]
### Далее
#### [[Создать свою MIB]]
---

---
### Теги
#info #snmp
### Назад
#### [[SNMP]]
### Далее
#### [[Создать свою MIB]]
---
# Общие сведения
Структура:
* Агент - тот, кого опрашивают
* Менеджер - тот, кто опрашивает
* MIB (Management Information Base) - база данных

Версии:
* SNMPv1 (RFC 1157)
Базовая функциональность, простота настройки.
Нет полноценного механизма аутентификации: любой, кто имеет доступ к сети, может прочитать или изменить данные.
Отсутствует шифрование, вся информация, включая «пароль» (community string), передаётся в открытом виде.
Поддерживает только функции с 32-битными счётчиками и базовые операции: GET, SET, TRAP.
* SNMPv2c (RFC 1901-1908)
Улучшения в области производительности, безопасности, конфиденциальности и связях между менеджерами.
Введена операция **GetBulkRequest** для получения большого количества управляющих данных через один запрос.
Реализован второй тип ловушки — **Inform**, в отличие от Trap, здесь отправляется подтверждение о получении.
Существует в нескольких вариантах, наиболее распространённый — SNMPv2c (community-based).
* SNMP v3 (RFC 3411-3418)
Повышенная безопасность за счёт механизма аутентификации по имени пользователя и паролю, а также шифрования (через предустановленный ключ).
Используется модель безопасности на основе пользователя (USM) для обеспечения безопасности сообщений.
Поддерживает алгоритмы шифрования, такие как DES, 3DES или AES, для шифрования полезной нагрузки сообщения SNMP.
Используется модель контроля доступа на основе представлений (VACM) для доступа к управляемым объектам.
Поддерживает идентификатор **Engine ID**, который однозначно идентифицирует каждый идентификатор SNMP, и используется для генерации уникального ключа для аутентификации сообщений.

Для транспортировки обычно использует **UDP**, но может и **TCP**.
Обмен данными основан на **Protocol Data Unit (PDU)** — пакетах объектов, которые инкапсулируются в транспортный протокол. Каждое сообщение PDU содержит определённую команду.

У каждого объекта есть OID. Они определены в файле MIB.
1. Менеджер посылает запрос SNMP агенту c указанием .
```bash unfold
snmpget -v2c -c public 192.168.0.128 1.3.6.1.2.1.1.1.0
```
2. Агент отвечает
```bash unfold
SNMPv2-MIB::sysDescr.0 = STRING: D-Link DES-3528 Fast Ethernet Switch
```

| Консольные утилиты | Значение               |
| ------------------ | ---------------------- |
| snmpget            | Получить конкретны OID |
| snmpwalk           | Получить дерево OID    |
| snmpset            | Изменить настройки OID |

| Команды SNMP v1 | Значение                                     |
| --------------- | -------------------------------------------- |
| Get             | Получить значение одного или нескольких OID  |
| GetNext         | Получить следующий OID (для обхода дерева)   |
| Set             | изменить значение OID                        |
| Trap            | асинхронное уведомление от агента менедженру |

| Команды SNMP v2 | Значение                                             |
| --------------- | ---------------------------------------------------- |
| GetBulk         | массовое получение (оптимизированная версия GetNext) |
| Inform          | уведомление, но с подтверждением доставки            |
| Response        | ответ агента на запрос менеджера                     |

| Команды SNMP v3 | Значение                                   |
| --------------- | ------------------------------------------ |
| Report          | сообщения об ошибках или статусе в SNMP v3 |

MIB-файлы пишутся на языке **ASN.1 (Abstract Syntax Notation One)**.  
Обычно расширение `.mib` или `.txt`.
Пример простого объекта из стандартного `MIB-II` (RFC 1213):
```text unfold
sysName OBJECT-TYPE
    SYNTAX      DisplayString (SIZE (0..255))
    MAX-ACCESS  read-write
    STATUS      current
    DESCRIPTION
        "Административное имя узла."
    ::= { system 5 }
```
- **OBJECT-TYPE** — определяет объект в MIB.
- **SYNTAX** — тип данных:
    - INTEGER (с перечислениями),
    - OCTET STRING,
    - Gauge32, Counter32, Counter64,
    - IpAddress, TimeTicks, OID, и т.д.
- **MAX-ACCESS** — права доступа:
    - `not-accessible`
    - `read-only`
    - `read-write`
    - `accessible-for-notify` (для TRAP/INFORM)
- **STATUS** — статус объекта:
    - `current`
    - `deprecated`
    - `obsolete`
- **DESCRIPTION** — текстовое описание.
- **::= { parent \<id\> }** — привязка к дереву OID (здесь `system(1)` в `mib-2(1)` → объект №5).

Для своего OID ветки нужно зарегистрировать ID в IANA. Для тестов можно взять фиктивное типо 9999.